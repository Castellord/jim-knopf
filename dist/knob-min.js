var Knob=function(e,t){var n=document.createElement("div");n.setAttribute("tabindex",0),e.parentNode.replaceChild(n,e),e.style.cssText="position: absolute; top: -10000px",n.appendChild(e);var r=this.settings=this._getSettings(e);this.value=parseFloat(e.value),this.input=e,this.min=r.min,this.range=r.max-r.min,this.ui=t,e.addEventListener("change",this.changed.bind(this),!1);var i={keydown:this._handleKeyEvents.bind(this),mousewheel:this._handleWheelEvents.bind(this),DOMMouseScroll:this._handleWheelEvents.bind(this),touchstart:this._handleMove.bind(this,"touchmove","touchend"),mousedown:this._handleMove.bind(this,"mousemove","mouseup")};for(var s in i)n.addEventListener(s,i[s],!1);n.style.cssText="position: relative; width:"+r.width+"px;"+"height:"+r.height+"px;",this.centerX=n.offsetLeft+r.width/2,this.centerY=n.offsetTop+r.height/2,t.init(n,r),this.changed(0)};Knob.prototype={_handleKeyEvents:function(e){var t=e.keyCode;if(t>=37&&t<=40){e.preventDefault();var n=1+e.shiftKey*9;this.changed({37:-1,38:1,39:1,40:-1}[t]*n)}},_handleWheelEvents:function(e){e.preventDefault();var t=e.detail||e.wheelDeltaX,n=e.detail||e.wheelDeltaY,r=t>0||n>0?1:t<0||n<0?-1:0;this.changed(r)},_handleMove:function(e,t){var n=this._updateWhileMoving.bind(this);document.body.addEventListener(e,n,!1),document.body.addEventListener(t,function(){document.body.removeEventListener(e,n,!1)},!1)},_updateWhileMoving:function(e){var t=e.changedTouches?e.changedTouches[0]:e,n=this.centerY-t.pageY,r=this.centerX-t.pageX,i=Math.atan2(-n,-r)*180/Math.PI+90-this.settings.angleoffset;i<0&&(i+=360);var s=Math.max(Math.min(1,i%360/this.settings.anglerange),0);this.value=this.input.value=this.min+this.range*s,this.ui.update(s,this.value)},changed:function(e){this.input.value=parseFloat(this.input.value)+e*(this.input.step||1),this.value=this.input.value,this.ui.update(this._valueToPercent(),this.value)},_valueToPercent:function(){return this.value!=null?100/this.range*(this.value-this.min)/100:this.min},_getSettings:function(e){var t={max:parseFloat(e.max),min:parseFloat(e.min)},n=e.dataset;for(var r in n)if(n.hasOwnProperty(r)){var i=+n[r];t[r]=isNaN(i)?n[r]:i}return t}};var Ui=function(){};Ui.El=function(){},Ui.El.prototype={svgNS:"http://www.w3.org/2000/svg",init:function(e,t,n,r){this.width=e,this.height=t,this.x=n||0,this.y=r||0,this.left=this.x-e/2,this.right=this.x+e/2,this.top=this.y-t/2,this.bottom=this.y+t/2},create:function(e,t){this.node=document.createElementNS(this.svgNS,e);for(var n in t)this.attr(n,t[n])},rotate:function(e,t,n){this.attr("transform","rotate("+e+" "+(t||this.x)+" "+(n||this.y)+")")},attr:function(e,t){this.node.setAttribute(e,t)},append:function(e){this.node.appendChild(e.node)}},Ui.El.Triangle=function(){this.init.apply(this,arguments),this.create("polygon",{points:this.left+","+this.bottom+" "+this.x+","+this.top+" "+this.right+","+this.bottom})},Ui.El.Triangle.prototype=Object.create(Ui.El.prototype),Ui.El.Rect=function(){this.init.apply(this,arguments),this.create("rect",{x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height})},Ui.El.Rect.prototype=Object.create(Ui.El.prototype),Ui.El.Circle=function(e,t,n){this.init(e*2,e*2,t,n),this.create("circle",{cx:this.x,cy:this.y,r:e})},Ui.El.Circle.prototype=Object.create(Ui.El.prototype),Ui.El.Text=function(e,t,n){this.create("text",{x:t,y:n}),this.node.textContent=e},Ui.El.Text.prototype=Object.create(Ui.El.prototype),Ui.El.Arc=function(e){this.options=e,this.options.angleoffset=(e.angleoffset||0)-90,this.create("path")},Ui.El.Arc.prototype=Object.create(Ui.El.prototype),Ui.El.Arc.prototype.setAngle=function(e){this.attr("d",this.getCoords(e))},Ui.El.Arc.prototype.getCoords=function(e){function p(e,t){return{x:o+e*Math.cos(t),y:o+e*Math.sin(t)}}var t=this.options.angleoffset,n=this.options.outerRadius,r=this.options.innerRadius,i=Math.PI*t/180,s=Math.PI*(t+e)/180,o=this.options.width/2,u=p(n,s),a=p(n,i),f=p(r,i),l=p(r,s),c="M"+u.x+","+u.y,h=e<180?0:1;return c+=" A"+n+","+n+" 0 "+h+" 0 "+a.x+","+a.y,c+="L"+f.x+","+f.y,c+=" A"+r+","+r+" 0 "+h+" 1 "+l.x+","+l.y,c+="L"+u.x+","+u.y,c},Ui.prototype={init:function(e,t){this.options||(this.options={}),this.merge(this.options,t),this.width=t.width,this.height=t.height,this.createElement(e);if(!this.components)return;this.components.forEach(function(e){e.init(this.node,t)}.bind(this))},merge:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},addComponent:function(e){this.components||(this.components=[]),this.components.push(e)},update:function(e,t){if(!this.components)return;this.components.forEach(function(n){n.update(e,t)})},createElement:function(e){var t=new Ui.El(this.width,this.height);t.create("svg",{version:"1.2",baseProfile:"tiny",width:this.width,height:this.height}),e.appendChild(t.node),this.node=t.node}},Ui.Pointer=function(e){this.options=e||{},this.options.type&&Ui.El[this.options.type]||(this.options.type="Triangle")},Ui.Pointer.prototype=Object.create(Ui.prototype),Ui.Pointer.prototype.update=function(e){this.shape.rotate(this.options.angleoffset+e*this.options.anglerange,this.width/2,this.height/2)},Ui.Pointer.prototype.createElement=function(e){this.shape=new Ui.El[this.options.type](this.options.pointerWidth,this.options.pointerHeight,this.width/2,this.options.pointerHeight/2+this.options.offset),e.appendChild(this.shape.node)},Ui.Arc=function(e){this.options=e||{}},Ui.Arc.prototype=Object.create(Ui.prototype),Ui.Arc.prototype.createElement=function(e){this.shape=new Ui.El.Arc(this.options),e.appendChild(this.shape.node)},Ui.Arc.prototype.update=function(e){this.shape.setAngle(e*this.options.anglerange)},Ui.Scala=function(e){this.options=e||{},this.options.steps||(this.options.steps=10),this.options.radius||(this.options.radius=this.options.width/2)},Ui.Scala.prototype=Object.create(Ui.prototype),Ui.Scala.prototype.createElement=function(e){this.doc=new Ui.El(this.width,this.height),this.startAngle=this.options.angleoffset||0,this.options.radius||(this.options.radius=this.height/2.5),this.doc.create("g");if(this.options.drawScale){var t=this.options.anglerange/this.options.steps,n=this.options.steps+(this.options.anglerange==360?0:1);for(var r=0;r<n;r++){var i=new Ui.El.Rect(1,3,this.width/2,this.height/2-this.options.radius);i.rotate(this.startAngle+r*t,this.width/2,this.height/2),this.doc.append(i)}}e.appendChild(this.doc.node),this.options.drawDial&&this.dial()},Ui.Scala.prototype.dial=function(){var e=this.options.anglerange/this.options.steps,t=this.options.min,n=(this.options.max-t)/this.options.steps,r=this.options.steps+(this.options.anglerange==360?0:1);for(var i=0;i<r;i++){var s=new Ui.El.Text(t+n*i,this.width/2-2.5,this.height/2-this.options.radius);this.doc.append(s),s.rotate(this.startAngle+i*e,this.width/2,this.height/2)}},Ui.P1=function(){"use strict";this.addComponent(new Ui.Pointer({type:"Rect",pointerWidth:2,pointerHeight:15,offset:10})),this.addComponent(new Ui.Scala({drawScale:!1,drawDial:!0}))},Ui.P1.prototype=Object.create(Ui.prototype),Ui.P1.prototype.createElement=function(){"use strict";Ui.prototype.createElement.apply(this,arguments);var e=new Ui.El.Circle(this.width/3.3,this.width/2,this.height/2);this.node.appendChild(e.node),this.node.setAttribute("class","p1")},Ui.P2=function(){"use strict";this.addComponent(new Ui.Arc({outerRadius:20,innerRadius:18})),this.addComponent(new Ui.Pointer({type:"Rect",pointerWidth:3,pointerHeight:23,offset:5}))},Ui.P2.prototype=Object.create(Ui.prototype),Ui.P2.prototype.createElement=function(){"use strict";Ui.prototype.createElement.apply(this,arguments),this.merge(this.options,{radius:20});var e=new Ui.El.Arc(this.options);e.setAngle(+this.options.anglerange),this.node.appendChild(e.node),this.node.setAttribute("class","p2")},Ui.P3=function(){"use strict";this.addComponent(new Ui.Arc({outerRadius:20,innerRadius:10}))},Ui.P3.prototype=Object.create(Ui.prototype),Ui.P3.prototype.createElement=function(){"use strict";Ui.prototype.createElement.apply(this,arguments),this.merge(this.options,{outerRadius:20,innerRadius:10});var e=new Ui.El.Arc(this.options);e.setAngle(this.options.anglerange),this.node.appendChild(e.node),this.node.setAttribute("class","p3")};